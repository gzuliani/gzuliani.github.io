<html>
<head>
<title>Overview Pyramid con CCCC</title>
<link rel='stylesheet' type='text/css' href='../css/main.css'></link>
</head>
<body>
<p class="page-path"><a href="../index.html#pyramid-cccc">risorse</a> | pyramid/cccc</p>
<h1>Overview Pyramid con CCCC</h1>
<h2>Introduzione</h2>
<p>Poich&eacute; l'Overview Pyramid generata a partire dalle metriche prodotte da SourceMonitor manca di alcuni parametri (cfr. <a href="overview-pyramid.html">Overview Pyramid con SourceMonitor</a>), ho provato a verificare cosa si riesce ad ottenere con CCCC.</p>
<img src="img/overview-pyramid-cccc/pyramid-transparent.png" alt="esempio di overview pyramid ottenuta da CCCC">
<h2>Implementazione</h2>
<p>L'implementazione &egrave; simile a quella realizzata per SourceMonitor: uno <a href="files\overview-pyramid-cccc\pyramid.cmd">script</a> da linea di comando si occupa di prima di lanciare CCCC, quindi di avviare uno <a href="files\overview-pyramid-cccc\pyramid.py">script Python</a> che produce esattamente lo stesso file XML prodotto a partire dai file CSV di SourceMonitor, cos&igrave; da riutilizzare la <a href="files\overview-pyramid-cccc\templates\pyramid.xsl">trasformazione XSLT</a> e il <a href="files\overview-pyramid-cccc\templates\pyramid.css">foglio di stile</a> gi&agrave; disponibili.</p>
<h2>Difformit&agrave;</h2>
<p>Salta subito agli occhi una notevole discrepanza delle stime delle metriche estratte dai due strumenti, in particolare nei valori attribuiti a <em>LOC</em> e <em>CYCLO</em>:</p>
<table cellspacing="0" cellpadding="0">
 <tr><th>Metrica</th><th>SourceMonitor</th><th>CCCC</th><th>differenza (%)</th></tr>
 <tr><td>ANDC</td><td class="centered">n/a</td><td class="centered">.6<td class="centered">n/a</td></td></tr>
 <tr><td>AHH</td><td class="centered">n/a</td><td class="centered">1.1</td><td class="centered">n/a</td></tr>
 <tr><td>NOP</td><td class="centered">49</td><td class="centered">47</td><td class="centered">4,1</td></tr>
 <tr><td>NOC</td><td class="centered">1500</td><td class="centered">1380</td><td class="centered">8,0</td></tr>
 <tr><td>NOM</td><td class="centered">7215</td><td class="centered">6978</td><td class="centered">3,3</td></tr>
 <tr><td>LOC</td><td class="centered">186465</td><td class="centered">84294</td><td class="centered">54,8</td></tr>
 <tr><td>CYCLO</td><td class="centered">14007</td><td class="centered">8124</td><td class="centered">42,0</td></tr>
 <tr><td>CALLS</td><td class="centered">34708</td><td class="centered">n/a</td><td class="centered">n/a</td></tr>
 <tr><td>FANOUT</td><td class="centered">n/a</td><td class="centered">5028</td><td class="centered">n/a</td></tr>
</table>
<h3>LOC</h3>
<p>Confrontando i conteggi dei due strumenti con un terzo (CLOC, nella fattispecie), si conclude che il <em>LOC</em> di SourceMonitor &egrave; il <em>Physical SLOC</em><sup><a href="#ref-1">[1]</a></sup>, mentre la stima di CCCC &egrave; pi&ugrave; prossima al numero di linee non vuote, tenendo conto che CCCC ignora quelle contenenti delle direttive per il preprocessore:</p>
<table cellspacing="0" cellpadding="0">
 <tr><th>Tool</th><th>Versione</th><th>Vuote</th><th>Commenti</th><th>Codice</th><th>Istruzioni</th><th>Non Vuote</th><th>Totale</tr>
 <tr><td>CLOC</td><td class="centered">1.60</td><td class="centered">48695</td><td class="centered">11198</td><td class="centered">126572</td><td class="centered">n/a</td><td class="centered">137770</td><td class="centered">186465</tr>
 <tr><td>CCCC</td><td class="centered">3.1.4</td><td class="centered">n/a</td><td class="centered">15194</td><td class="centered">101529</td><td class="centered">n/a</td><td class="centered">n/a</td><td class="centered">116723</tr>
 <tr><td>SourceMonitor</td><td class="centered">3.4.6.301</td><td class="centered">n/a</td><td class="centered">n/a</td><td class="centered">186465</td><td class="centered">33669</td><td class="centered">n/a</td><td class="centered">186465</tr>
</table>
<p><strong>SourceMonitor</strong>:</p>
<blockquote>Lines Metric: the number of physical lines in a source file, or for a checkpoint the total number of lines in all files in the checkpoint.</blockquote>
<p><strong>CCCC</strong>:</p>
<blockquote>[...] Preprocessor lines are treated as blank.</blockquote>
<p>&Egrave; possibile inibire il conteggio delle linee vuote in SourceMonitor aggiungendo il seguente comando nel file <em>batch</em> di progetto:</p>
<pre class="code">
 &lt;modified_complexity&gt;true&lt;/modified_complexity&gt;
 <ins>&lt;ignore_blank_lines&gt;true&lt;/ignore_blank_lines&gt;</ins>
 &lt;source_directory&gt;...&lt;/source_directory&gt;
</pre>
<p>Il conteggio in questo caso scende da 186465 a 137768, valore molto prossimo quello fornito da CLOC (137770), ma comunque piuttosto distante dalla stima di CCCC (116723, pari a uno scostamento del 37,4%).</p>
<h3>CYCLO</h3>
<p>Le discrepanze su questa metrica si spiega per la differente metodologia di calcolo: SourceMonitor, rispetto a CCCC, conta anche le uscite anticipate dai blocchi <span class="code">switch</span>, oltre alle istruzioni <span class="code">catch</span>.</p>
<p><strong>SourceMonitor:</strong></p>
<blockquote>
Each function or method has a complexity of one plus one for each branch statement such as if, else, for, foreach, or while. Arithmetic if statements (MyBoolean ? ValueIfTrue : ValueIfFalse) each add one count to the complexity total. A complexity count is added for each '&amp;&amp;' and '||' in the logic within if, for, while or similar logic statements. 

Switch statements add complexity counts for each exit from a case (due to a break, goto, return, throw, continue, or similar statement), and one count is added for a default case even if one is not present. (Note: when a project's Modified Complexity option is selected, switch statements add a count of one to the complexity and the internal case statements do not contribute to the complexity metric.) Each catch or except statement in a try block (but not the try or finally statements) each add one count to the complexity as well.
</blockquote>
<p><strong>CCCC</strong>:</p>
<blockquote>
In the case of C++, the count is incremented for each of the following tokens: 'if','while','for','switch','break','&amp;&amp;','||'.
</blockquote>
<!--
<p>L'<em>Overview Pyramid</em> &egrave; una rappresentazione sintetica dello stato di un progetto software.</p>
<img src="img/overview-pyramid/pyramid.png" alt="esempio di overview pyramid"/>
<p>La piramide &egrave; suddivisa in tre parti: il vertice, con le metriche relative alle gerarchie ereditarie, la parte di sinistra, con quelle associate alla dimensione e alla complessit&agrave; del codice, e la parte di destra, con quelle sull'accoppiamento del sistema.</p>
<h3>Il vertice: <em>system inheritance</em></h3>
<p>Il vertice della piramide mostra due indici relativi all'ereditariet&agrave;:</p>
<dl>
<dt>ANDC (average number of derived classes)</dt><dd>numero medio di classi derivate;</dd>
<dt>AHH (average hierarchy height)</dt><dd>lunghezza media delle catene di derivazione.</dd>
</dl>
<p><em>ANDC</em> misura l'ampiezza media degli alberi di derivazione: valori bassi di questo parametro denotano gerarchie &ldquo;strette&rdquo;, che si sviluppano prevalentemente in verticale, mentre valori alti caratterizzano gerarchie &ldquo;larghe&rdquo;, che si sviluppano prevalentemente in orizzontale.</p>
<p><em>AHH</em> misura la profondit&agrave; media degli alberi di derivazione: valori bassi denotano gerarchie che si sviluppano su pochi livelli, viceversa, valori alti caratterizzano gerarchie piuttosto &ldquo;alte&rdquo; che si sviluppano cio&eagrave; su molti livelli.</p>
<p>Valori bassi di entrambi gli indici denotano l'assenza di strutture gerarchiche significative: il sistema &egrave; composto per la maggior parte di classi autonome.</p>
<h3>La parte di sinistra: <em>system size &amp; complexity</em></h3>
<p>La parte di sinistra della piramide riporta cinque indici relativi alla dimensione del codice e della sua complessit&agrave;:</p>
<dl>
<dt>NOP (number of packages)</dt><dd>numero di componenti del sistema (in C++ coincide col numero di <span class="code">namespaces</span> definiti);</dd>
<dt>NOC (number of classes)</dt><dd>numero di classi del sistema (in C++ coincide con il numero delle <span class="code">class</span> e delle <span class="code">struct</span>);</dd>
<dt>NOM (number of methods)</dt><dd>numero totale dei metodi definiti (in C++ comprende anche le funzioni globali);</dd>
<dt>LOC (lines of code)</dt><dd>numero di linee di codice;</dd>
<dt>CYCLO (cyclomatic complexity index)</dt><dd>somma delle complessit&agrave; attribuite ai metodi del sistema.</dd>
</dl>
<p>L'analisi della dimensione e della complessit&agrave; del codice avviene sulla base dei rapporti di queste metriche:</p>
<dl>
<dt>NOC/NOP (high-level structuring)</dt><dd>misura la granularit&agrave; dei componenti: valori bassi denotano la presenza di componenti &ldquo;poveri&rdquo;, contenenti cio&egrave; poche classi, mentre valori alti sono caratteristici di sistemi con componenti troppo &ldquo;ricchi&rdquo;;</dd>
<dt>NOM/NOC (class structuring)</dt><dd>misura il livello di distribuzione delle attivit&agrave; del sistema tra le classi: valori bassi denotano la presenza di classi &ldquo;stupide&rdquo;, prive cio&egrave; di un numero adeguato di metodi, mentre valori alti indicano classi con troppe responsabilit&agrave;;</dd>
<dt>LOC/NOM (operation structuring)</dt><dd>misura il grado di distribuzione delle funzionalit&agrave; del sistema tra i metodi; valori alti denotano la presenza di metodi particolarmente &ldquo;lunghi&rdquo;, composti cio&egrave; da un numero eccessivo di operazioni, valori bassi sono invece associabili a metodi particolarmente &ldquo;brevi&rdquo;;</dd>
<dt>CYCLO/LOC (intrinsic operation complexity)</dt><dd>misura la complessit&agrave; media di un'operazione: valori bassi denotano la presenza di metodi &ldquo;semplici&rdquo;, tendenzialmente lineari, mentre valori alti caratterizzano metodi con un numero eccessivo di istruzioni condizionali.</dd>
</dl>
<h3>La parte di destra: <em>system coupling</em></h3>
<p>La parte di destra della piramide riporta due indici relativi all'accoppiamento dei componenti del sistema:</p>
<dl>
<dt>CALLS</dt><dd>numero di chiamate distinte effettuate (nel contesto di un singolo metodo, pi&ugrave; chiamate alla stessa funzione conta come una);</dd>
<dt>FANOUT</dt><dd>numero di tipi distinti riferiti (nel contesto di un singolo metodo, pi&ugrave; riferimenti ad uno stesso tipo conta come uno).</dd>
</dl>
<p>L'analisi del grado di accoppiamento del sistema avviene sulla base dei rapporti di queste metriche:</p>
<dl>
<dt>CALLS/NOM (coupling intensity)</dt><dd>numero medie di chiamate effettuate durante l'esecuzione di un'operazione; valori bassi denotano sistemi poco strutturati, viceversa alti valori sono caratteristici dei sistemi fortemente modulari, in cui le operazioni pi&ugrave; complesse sono realizzate per composizione di attivit&agrave; pi&ugrave; semplici;</dd>
<dt>FANOUT/CALLS (coupling dispersion)</dt><dd>numero medio di classi coinvolte nell'esecuzione di un'operazione: valori bassi denotano sistemi &ldquo;coesi&rdquo;, nei quali cio&egrave; le funzionalit&agrave; sono realizzate da poche classi, valori alti sono invece caratteristici dei sistemi &ldquo;frammentati&rdquo;.</dd>
</dl>
<h2>Creazione del prospetto</h2>
<p>Per generalit&agrave;, ho predisposto una <a href="files/overview-pyramid/templates/pyramid.xsl">trasformazione XSLT</a> che produce la piramide a partire da un file XML contenente le metriche di base. Segue un esempio di file XML sorgente:</p>
<pre class="code">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;us-ascii&quot;?&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;pyramid.xsl&quot;?&gt;
&lt;pyramid tool=&quot;SourceMonitor&quot;&gt;
 &lt;andc&gt;&lt;/andc&gt;
 &lt;ahh&gt;&lt;/ahh&gt;
 &lt;nop&gt;49&lt;/nop&gt;
 &lt;noc&gt;1500&lt;/noc&gt;
 &lt;nom&gt;7215&lt;/nom&gt;
 &lt;loc&gt;186497&lt;/loc&gt;
 &lt;cyclo&gt;14009&lt;/cyclo&gt;
 &lt;calls&gt;34714&lt;/calls&gt;
 &lt;fanout&gt;&lt;/fanout&gt;
&lt;/pyramid&gt;
</pre>
<p>Il prospetto HTML prodotto dalla traformazione (cfr. <a href="files/overview-pyramid/example/pyramid.htm">esempio</a>) riporta, oltre alla piramide, i valori soglia applicati ai diversi indici della piramide (sezione <em>Thresholds</em>), nonché delle indicazioni circa le possibili cause associate a valori fuori norma (sezione <em>Smells</em>).</p>
<h2>Raccolta delle metriche</h2>
<p>Ho condotto il primo esperimento di costruzione della piramide con una versione <em>beta</em> di SourceMonitor, la 3.4.6.301 (quelle precedenti hanno qualche problema nell'esportazione dei dati da linea di comando).</p>
<p>La procedura si compone di due passi:</p>
<ol>
<li>esportazione delle metriche;</li>
<li>analisi delle metriche e salvataggio degli aggregati su file XML.</li>
</ol>
<p>Ho sfruttato la capacit&agrave; di SourceMonitor di esportare le metriche di dettaglio del progetto e quelle di metodo su file CSV: ho perci&ograve; predisposto un file <a href="files/overview-pyramid/sourcemonitor_commands.xml"><em>batch per SourceMonitor</em></a> con i riferimenti alle cartelle del progetto software da analizzare e ho preparato uno <a href="files/overview-pyramid/pyramid.py">script <em>Python</em></a> per ricavare dai due file CSV le metriche necessarie alla costruzione della piramide. Ho infine automatizzato la procedura di esportazione e aggregazione delle metriche con un ulteriore file <a href="files/overview-pyramid/pyramid.cmd"><em>batch per Console</em></a>.</p>
<p class="note">Nota: SourceMonitor non determina tutte le metriche necessarie all'istanziazione degli indici della piramide (nella fattispecie: ANDC, AHH, NOP e FANOUT); per questo motivo, alcuni di essi sono marcati come <em>n/a &ndash; not available</em>. NOP viene stimato dallo script python, che assume essere equivalente al numero di cartelle in cui sono stati suddivisi i file sorgente.</p>
<h2>Conclusioni</h2>
<p>Una volta copiati gli script <a href="files/overview-pyramid/pyramid.cmd"><span class="code">pyramid.cmd</span></a> e <a href="files/overview-pyramid/pyramid.py"><span class="code">pyramid.py</span></a> in una cartella dedicata, e aver salvato in una cartella denominata <span class="code">templates</span> i due file <a href="files/overview-pyramid/templates/pyramid.xsl"><span class="code">pyramid.xsl</span></a> e <a href="files/overview-pyramid/templates/pyramid.css"><span class="code">pyramid.css</span></a>, il prospetto va generato lanciando il comando:</p>
<pre class="code">
    pyramid.cmd &lt;sourcemonitor-command-file&gt; &lt;output-dir&gt;
</pre>
<p>ove <span class="code">&lt;sourcemonitor-command-file&gt;</span> &egrave; il percorso al file batch di SourceMonitor, mentre <span class="code">&lt;output-dir&gt;</span> &egrave; il nome della cartella dove il prospetto sar&agrave; salvato.</p>
<p>Se la procedura si conclude senza errori, l'apertura del file <span class="code">&lt;output-dir&gt;\pyramid.xml</span> in un qualunque <em>browser</em> produrr&agrave; il prospetto atteso.</p>
-->
<p class="update"><strong>Aggiornamento [02/12/2013]</strong></p>
<p>Lo script di creazione del prospetto ora vuole anche il nome e il numero di versione del progetto software da inserire nel titolo del prospetto:</p>
<pre class="code">
Usage: pyramid.cmd &lt;project-name&gt; &lt;project-version&gt; &lt;output-dir&gt; &lt;source-dir&gt;+
</pre>
<p>Oltre all'indicazione dello strumento utilizzato per raccogliere le metriche, in testata ora viene riportata anche la data di creazione del prospetto stesso.</p>
<h2>Riferimenti</h2>
<ol>
<a name="ref-1"></a>
<li>&quot;Source lines of code&quot;. <em>Wikipedia</em>. &lt;<a href="http://en.wikipedia.org/wiki/Source_lines_of_code">http://en.wikipedia.org/wiki/Source_lines_of_code</a>&gt;. Visitato il 28 Novembre 2013.</li>
<a name="ref-2"></a>
<li>Littlefair, T. &quot;CCCC&quot;. <em>sourceforge.net</em>. &lt;<a href="http://cccc.sourceforge.net/">http://cccc.sourceforge.net/</a>&gt;</li>
<a name="ref-3"></a>
<li>Danial, A. &quot;CLOC&quot;. <em>sourceforge.net</em>. &lt;<a href="http://cloc.sourceforge.net/">http://cloc.sourceforge.net/</a>&gt;</li>
</ol>
<p class="modification-notice">Pagina modificata il 28/11/2013</p>
</body>
</html>
