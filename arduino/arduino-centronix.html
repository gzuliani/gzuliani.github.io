<html>
<head>
<meta charset="UTF-8">
<title>Porta parallela con Arduino</title>
<link href="../css/main.css" rel="stylesheet" type="text/css"></link>
<link href="css/arduino-centronix.css" rel="stylesheet" type="text/css"></link>
</head>
<body>
<p class="page-path"><a href="../index.html#arduino-mpu6050">risorse</a> | porta parallela con arduino</p>
<h1>Porta parallela con Arduino</h1>
<p class="disclaimer"><strong>Attenzione:</strong> ho posto la massima cura ed attenzione nel redigere questi appunti; declino tuttavia ogni responsabilità per eventuali imprecisioni, errori od omissioni, così come declino ogni responsabilità per eventuali danni a cose, proprietà o persone derivanti dall’uso di questi contenuti.</p>
<p class="todo">Trovato la stampante ad aghi Facit B1200 (compatibile Epson FX-80)...</p>
<h2>Centronix (o compatibility) mode</h2>
<h3>Proprietà elettriche</h3>
<p class="todo">bla bla bla...</p>
<p class="todo">Centronix vs D-sub 25...</p>
<p class="todo">verificato che non servono componenti discreti in mezzo (tutto TTL)...</p>
<h3>ProLogico</h3>
<p>Da <a href="http://www.ni.com/white-paper/3466/en/">IEEE 1284 - Updating the PC Parallel Port</a>:</p>
<blockquote>When the printer is ready to receive data, it drives BUSY low. The host drives valid data on the data lines, waits a minimum of 500 ns, then pulses STROBE* for a minimum of 500 ns. Valid data must remain on the data lines for a minimum of 500 ns after the rising edge of STROBE*. The printer will receive the data and drive BUSY active to indicate that it is processing the data. When the printer has completed the data transfer, it will pulse the ACK* line active for a minimum of 500 ns and de-assert BUSY, indicating it is ready for the next data byte.</blockquote>
<p class="todo">n vuol dire linea attiva bassa...</p>
<p class="todo">la linea <span class="pin">Strobe</span> va manenuta normalmente alta;</p>
<ol>
<li>attendere che la linea <span class="pin">Busy</span> vada a 0;</li>
<li>scrivere il byte da inviare alla stampante sulle linee <span class="pin">Data</span>;</li>
<li>attendere almeno 0.5&micro;s;</li>
<li>portare la linea <span class="pin">Strobe</span> a 0 per almeno 0.5&micro;s;</li>
<li>attendere almeno 0.5&micro;s;</li>
<li>riportare la linea <span class="pin">Strobe</span> a 1.</li>
</ol>
<img src="img/arduino-centronix/handshake.png">
<p class="illustration">Tipico handshake Centronix</p>

<h2>Connessioni</h2>
<p>L'interfacciamento tra Arduino e il connettore D-sub 25 è costituito da un bus di 12 linee, 11 segnali più la massa:</p>
<table>
<img src="img/arduino-centronix/wiring.png">
<p class="illustration">Circuito di interfacciamento</p>
<tr><th>Signal</th><th>Arduino</th><th>D-sub 25</th><th class="wire"></th></tr>
<tr><td class="signal">nStrobe</td><td class="pin">2</td><td class="pin">1</td><td class="wire">nero</td></tr>
<tr><td class="signal">Data 0</td><td class="pin">3</td><td class="pin">2</td><td class="wire">bianco</td></tr>
<tr><td class="signal">Data 1</td><td class="pin">4</td><td class="pin">3</td><td class="wire">grigio</td></tr>
<tr><td class="signal">Data 2</td><td class="pin">5</td><td class="pin">4</td><td class="wire">viola</td></tr>
<tr><td class="signal">Data 3</td><td class="pin">6</td><td class="pin">5</td><td class="wire">blu</td></tr>
<tr><td class="signal">Data 4</td><td class="pin">7</td><td class="pin">6</td><td class="wire">verde</td></tr>
<tr><td class="signal">Data 5</td><td class="pin">8</td><td class="pin">7</td><td class="wire">giallo</td></tr>
<tr><td class="signal">Data 6</td><td class="pin">9</td><td class="pin">8</td><td class="wire">arancio</td></tr>
<tr><td class="signal">Data 7</td><td class="pin">10</td><td class="pin">9</td><td class="wire">rosso</td></tr>
<tr><td class="signal">nAck</td><td class="pin">11</td><td class="pin">10</td><td class="wire">marrone</td></tr>
<tr><td class="signal">Busy</td><td class="pin">12</td><td class="pin">11</td><td class="wire">bianco</td></tr>
<tr><td class="signal">Ground</td><td class="pin">GND</td><td class="pin">25</td><td class="wire">nero</td></tr>
</table>
<img src="img/arduino-centronix/circuit.jpg">
<p class="illustration">Realizzazione del bus di interfacciamento</p>
<img src="img/arduino-centronix/connector.jpg">
<p class="illustration">Particolare del bus lato D-sub 25</p>
<p class="modification-notice">Pagina modificata il 13/06/2017</p>
<h2>Test</h2>
<img src="img/arduino-centronix/first-print.jpg">
<p class="illustration">La prima stampa di prova</p>
<p class="todo">Il nastro è ok dopo più di 20 anni!!!</p>
<p>stty solo se serve!!!</p>
<pre class="code">
$ sudo stty -F /dev/ttyACM0 ispeed 9600 ospeed 9600 -ignpar cs8 -cstopb -echo
$ cat my-file.txt > /dev/ttyACM0
</pre>
<h3>Sorgenti</h3>
<ul>
<li><a href="files/arduino-centronix/centronix.ino">centronix.ino</a></p>
</ul>


EPSON ESC/P
<a href="https://files.support.epson.com/pdf/general/escp2ref.pdf">https://files.support.epson.com/pdf/general/escp2ref.pdf</a>


ESC x -> NLQ/DRAFT
ESC P -> 10cpi
ESC M -> 12cpi
ESC g -> 15cpi
ESC p -> proportional on/off
ESC E -> start bold
ESC F -> end bold
ESC 4 -> start italic
ESC 5 -> end italic
ESC G -> start double strike  (sovrapposizione verticale)
ESC H -> end double strike
ESC - -> underline on/off

<p class="modification-notice">Pagina modificata il 13/06/2017</p>
</body>
</html>
